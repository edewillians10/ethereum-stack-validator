- name: Assert MEV-Boost configuration when enabled
  assert:
    that:
      - mev_boost_download_url | length > 0
    fail_msg: "Defina mev_boost_download_url para habilitar o MEV-Boost."
  when: mev_enabled | default(false)
  tags: mev_boost

- name: Create MEV-Boost user and group
  user:
    name: "{{ mev_boost_user }}"
    system: yes
    create_home: no
    shell: /usr/sbin/nologin
  when: mev_enabled | default(false)
  tags: mev_boost

- name: Download MEV-Boost binary
  get_url:
    url: "{{ mev_boost_download_url }}"
    dest: "{{ mev_boost_bin }}"
    mode: "0755"
    checksum: "{{ mev_boost_checksum | default(omit) }}"
  when: mev_enabled | default(false)
  tags: mev_boost

- name: Warn that MEV-Boost service is not configured
  debug:
    msg: "MEV-Boost binario instalado em {{ mev_boost_bin }}; configure o service unit se desejar iniciar."
  when: mev_enabled | default(false)
  tags: mev_boost
