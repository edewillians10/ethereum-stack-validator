- name: ensure version check directory exists
  file:
    path: /opt/eth-monitoring
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: install version check script
  template:
    src: version-check.py.j2
    dest: /opt/eth-monitoring/version-check.py
    mode: "0755"

- name: configure version check environment
  template:
    src: version-check.env.j2
    dest: /etc/default/eth-version-check
    mode: "0640"

- name: install version check systemd unit
  template:
    src: version-check.service.j2
    dest: /etc/systemd/system/eth-version-check.service
    mode: "0644"
  notify: reload systemd

- name: install version check systemd timer
  template:
    src: version-check.timer.j2
    dest: /etc/systemd/system/eth-version-check.timer
    mode: "0644"
  notify: reload systemd

- name: enable and start version check timer
  systemd:
    name: eth version check.timer
    enabled: yes
    state: started
  when: version_check_enabled | default(true)
